(function () {

    DarkModeToggle();
    
    // Investigate how to implement the dark mode to the system prefers-color-scheme instead of using darkMode variable
    $( document ).ready(function() {
        storedMode = localStorage.getItem("darkMode");
        
        if (storedMode == null) {
            console.log("Hello ", storedMode);
            localStorage.setItem("darkMode", window.matchMedia('(prefers-color-scheme: dark)').matches
            ? 'dark'
            : 'light');
            document.getElementsByTagName('meta')["color-scheme"].content = window.matchMedia('(prefers-color-scheme: dark)').matches
            ? 'dark'
            : 'light';
    
        } else {
            document.getElementsByTagName('meta')["color-scheme"].content = storedMode;

            setDarkMode(storedMode);
  
        }
     });


})();


function getDarkMode() {

    return   document.getElementsByTagName('meta')["color-scheme"].content
   

}

function setDarkMode(mode) {
    if (mode == "light") {
        // nav bar
        var r = document.querySelector(':root');
        document.firstElementChild.setAttribute("color-css-theme", "light");
        r.style.setProperty('--background', 'rgba(255, 255, 255, 0.99)');
        r.style.setProperty('--nav-mobile-background-barely-transparent', 'rgba(249, 249, 249, 0.99)');
        r.style.setProperty('--nav-h3-color', '#5D5D5D');
        r.style.setProperty('--nav-span-color', '#33331E');
        r.style.setProperty('--nav-headline-h1', '#373737');
        r.style.setProperty('--three-bar-logo-color', '#303030');
        r.style.setProperty('--text_color', '#000000');
        $('.ubyssey_small_logo').attr("src","/static/ubyssey/images/ubyssey-logo-small.svg");
        $('.svg-darkmode').attr("d", "M375.7 19.7c-1.5-8-6.9-14.7-14.4-17.8s-16.1-2.2-22.8 2.4L256 61.1 173.5 4.2c-6.7-4.6-15.3-5.5-22.8-2.4s-12.9 9.8-14.4 17.8l-18.1 98.5L19.7 136.3c-8 1.5-14.7 6.9-17.8 14.4s-2.2 16.1 2.4 22.8L61.1 256 4.2 338.5c-4.6 6.7-5.5 15.3-2.4 22.8s9.8 13 17.8 14.4l98.5 18.1 18.1 98.5c1.5 8 6.9 14.7 14.4 17.8s16.1 2.2 22.8-2.4L256 450.9l82.5 56.9c6.7 4.6 15.3 5.5 22.8 2.4s12.9-9.8 14.4-17.8l18.1-98.5 98.5-18.1c8-1.5 14.7-6.9 17.8-14.4s2.2-16.1-2.4-22.8L450.9 256l56.9-82.5c4.6-6.7 5.5-15.3 2.4-22.8s-9.8-12.9-17.8-14.4l-98.5-18.1L375.7 19.7zM269.6 110l65.6-45.2 14.4 78.3c1.8 9.8 9.5 17.5 19.3 19.3l78.3 14.4L402 242.4c-5.7 8.2-5.7 19 0 27.2l45.2 65.6-78.3 14.4c-9.8 1.8-17.5 9.5-19.3 19.3l-14.4 78.3L269.6 402c-8.2-5.7-19-5.7-27.2 0l-65.6 45.2-14.4-78.3c-1.8-9.8-9.5-17.5-19.3-19.3L64.8 335.2 110 269.6c5.7-8.2 5.7-19 0-27.2L64.8 176.8l78.3-14.4c9.8-1.8 17.5-9.5 19.3-19.3l14.4-78.3L242.4 110c8.2 5.7 19 5.7 27.2 0zM256 368a112 112 0 1 0 0-224 112 112 0 1 0 0 224zM192 256a64 64 0 1 1 128 0 64 64 0 1 1 -128 0z")

    } else if (mode == "dark") {
        // nav ba
        var r = document.querySelector(':root');
        document.firstElementChild.setAttribute("color-css-theme", "dark");
        r.style.setProperty('--background', '#031621');
        r.style.setProperty('--nav-mobile-background-barely-transparent', '#020510');
        r.style.setProperty('--nav-h3-color', '#5D5D5D');
        r.style.setProperty('--nav-span-color', '#031621');
        r.style.setProperty('--nav-headline-h1', '#5D5D5D');
        r.style.setProperty('--three-bar-logo-color', '#EFEFEF');
        r.style.setProperty('--text_color', '#D9D9D9');
        $('.ubyssey_small_logo').attr("src","/static/ubyssey/images/ubyssey_logo_dark_mode.svg");
        $('.svg-darkmode').attr("d", "M0 610 l0 -610 2905 0 2905 0 0 610 0 610 -2905 0 -2905 0 0 -610zm130 525 c0 -41 -2 -45 -25 -45 -20 0 -25 -5 -25 -25 0 -18 -5 -25 -20 -25-15 0 -20 7 -20 25 0 18 5 25 20 25 17 0 20 7 20 45 0 41 2 45 25 45 23 0 25-4 25 -45z m230 0 c0 -38 -3 -45 -20 -45 -17 0 -20 7 -20 45 0 38 3 45 20 4517 0 20 -7 20 -45z m170 -70 c0 -18 5 -25 20 -25 18 0 20 -7 20 -55 0 -52 1-55 25 -55 21 0 25 -5 25 -30 0 -25 -4 -30 -25 -30 -21 0 -25 5 -25 30 0 28-2 30 -40 30 -38 0 -40 2 -40 30 0 25 -4 30 -25 30 -20 0 -25 5 -25 25 0 18-5 25 -20 25 -15 0 -20 7 -20 25 0 24 2 25 65 25 63 0 65 -1 65 -25z m140 0c0 -20 -5 -25 -25 -25 -20 0 -25 5 -25 25 0 20 5 25 25 25 20 0 25 -5 25 -25zm80 0 c0 -18 -5 -25 -20 -25 -15 0 -20 7 -20 25 0 18 5 25 20 25 15 0 20 -720 -25z m-620 -190 l0 -55 65 0 c63 0 65 1 65 25 0 23 3 25 50 25 49 0 50 150 30 0 23 4 30 20 30 16 0 20 -7 20 -30 0 -23 -4 -30 -20 -30 -18 0 -20 -7-20 -55 0 -48 -2 -55 -20 -55 -16 0 -20 7 -20 30 0 27 -3 30 -30 30 -27 0 -30-3 -30 -30 l0 -30 -90 0 -90 0 0 30 c0 23 -4 30 -20 30 -15 0 -20 7 -20 25 018 5 25 20 25 16 0 20 7 20 30 0 25 4 30 25 30 24 0 25 -3 25 -55z m1310 0 c0-48 -2 -55 -20 -55 -15 0 -20 7 -20 25 0 24 -3 25 -55 25 l-55 0 0 -260 0-260 -65 0 -65 0 0 260 0 260 -40 0 c-36 0 -40 -2 -40 -25 0 -18 -5 -25 -20-25 -18 0 -20 7 -20 55 l0 55 200 0 200 0 0 -55z m250 25 c0 -23 -4 -30 -20-30 -19 0 -20 -7 -20 -90 l0 -90 90 0 90 0 0 90 c0 83 -1 90 -20 90 -16 0 -207 -20 30 l0 30 110 0 110 0 0 -30 c0 -23 -4 -30 -20 -30 -19 0 -20 -7 -20-260 l0 -260 -70 0 -70 0 0 150 c0 143 -1 150 -20 150 -17 0 -20 -7 -20 -40l0 -40 -70 0 -70 0 0 -110 c0 -103 1 -110 20 -110 16 0 20 -7 20 -30 0 -23 -4-30 -20 -30 -16 0 -20 7 -20 30 l0 30 -65 0 c-63 0 -65 1 -65 25 0 20 5 25 2525 l25 0 0 235 0 235 -25 0 c-21 0 -25 5 -25 30 l0 30 85 0 85 0 0 -30z m720-25 c0 -52 -1 -55 -25 -55 -20 0 -25 5 -25 25 0 24 -2 25 -65 25 l-65 0 0-110 0 -110 45 0 c38 0 45 3 45 20 0 13 7 20 20 20 18 0 20 -7 20 -60 l0 -60-65 0 -65 0 0 -85 c0 -84 0 -85 25 -85 20 0 25 -5 25 -25 0 -22 4 -25 40 -2536 0 40 3 40 25 0 20 5 25 25 25 21 0 25 5 25 30 0 25 4 30 25 30 24 0 25 -325 -55 l0 -55 -50 0 c-49 0 -50 -1 -50 -30 l0 -30 -65 0 -65 0 0 30 0 30 -650 c-63 0 -65 1 -65 25 0 20 5 25 25 25 l25 0 0 210 0 210 -25 0 c-24 0 -25 3-25 55 l0 55 155 0 155 0 0 -55z m440 25 c0 -23 -4 -30 -20 -30 -19 0 -20 -7-20 -205 0 -198 1 -205 20 -205 16 0 20 -7 20 -30 l0 -30 100 0 100 0 0 235 0235 -25 0 c-21 0 -25 5 -25 30 l0 30 85 0 85 0 0 -30 c0 -23 -4 -30 -20 -30-15 0 -20 -7 -20 -25 0 -18 -5 -25 -20 -25 -19 0 -20 -7 -20 -235 l0 -235 -450 c-43 0 -45 -1 -45 -30 l0 -30 -95 0 -95 0 0 30 c0 25 -4 30 -25 30 -20 0-25 5 -25 25 0 18 -5 25 -20 25 -19 0 -20 7 -20 235 0 228 -1 235 -20 235 -160 -20 7 -20 30 l0 30 85 0 85 0 0 -30z m680 0 c0 -25 4 -30 25 -30 25 0 25 -125 -90 0 -89 0 -90 -25 -90 -18 0 -25 -5 -25 -20 0 -15 7 -20 25 -20 23 0 25-4 25 -40 0 -33 3 -40 20 -40 18 0 20 -7 20 -55 0 -48 -2 -55 -20 -55 -18 0-20 -7 -20 -55 l0 -55 -65 0 c-63 0 -65 1 -65 25 0 18 5 25 20 25 18 0 20 720 85 0 78 -2 85 -20 85 -17 0 -20 7 -20 40 0 36 -2 40 -25 40 -22 0 -25 -4-25 -40 0 -36 -2 -40 -25 -40 -25 0 -25 -1 -25 -85 0 -84 0 -85 25 -85 20 025 -5 25 -25 0 -25 -1 -25 -90 -25 -89 0 -90 0 -90 25 0 18 5 25 20 25 19 020 7 20 235 0 228 -1 235 -20 235 -16 0 -20 7 -20 30 l0 30 155 0 155 0 0 -30zm310 -55 c0 -78 2 -85 20 -85 16 0 20 -7 20 -35 0 -31 3 -35 25 -35 22 0 25 425 35 0 31 3 35 25 35 25 0 25 1 25 85 l0 85 70 0 70 0 0 -30 c0 -27 -3 -30-30 -30 -25 0 -30 -4 -30 -25 0 -18 -5 -25 -20 -25 -16 0 -20 -7 -20 -30 0-23 -4 -30 -20 -30 -18 0 -20 -7 -20 -55 0 -52 -1 -55 -25 -55 l-25 0 0 -1250 -125 25 0 c24 0 25 -3 25 -55 0 -52 -1 -55 -25 -55 -21 0 -25 5 -25 30 l030 -65 0 c-63 0 -65 1 -65 25 0 18 5 25 20 25 18 0 20 7 20 85 0 78 -2 85 -2085 -18 0 -20 7 -20 60 0 53 -2 60 -20 60 -18 0 -20 7 -20 65 0 63 -1 65 -2565 -20 0 -25 5 -25 25 0 20 -5 25 -25 25 -21 0 -25 5 -25 30 l0 30 90 0 90 00 -85z m570 30 c0 -48 -2 -55 -20 -55 -15 0 -20 7 -20 25 0 24 -2 25 -65 25l-65 0 0 -55 c0 -52 1 -55 25 -55 22 0 25 -4 25 -35 0 -28 4 -35 20 -35 13 020 -7 20 -20 0 -17 7 -20 40 -20 l40 0 0 -60 0 -60 30 0 c28 0 30 -3 30 -35 0-32 -2 -35 -30 -35 -30 0 -30 -1 -30 -55 l0 -55 -40 0 c-38 0 -40 -2 -40 -30l0 -30 -65 0 -65 0 0 30 c0 23 -4 30 -20 30 -15 0 -20 7 -20 25 0 18 -5 25-20 25 -16 0 -20 7 -20 30 0 28 2 30 40 30 38 0 40 -2 40 -30 0 -23 4 -30 20-30 15 0 20 -7 20 -25 0 -23 4 -25 45 -25 l45 0 0 90 c0 83 -1 90 -20 90 -130 -20 7 -20 20 0 17 -7 20 -45 20 l-45 0 0 40 c0 33 -3 40 -20 40 -19 0 -20 7-20 110 0 103 1 110 20 110 16 0 20 7 20 30 l0 30 105 0 105 0 0 -55z m360 0c0 -48 -2 -55 -20 -55 -15 0 -20 7 -20 25 0 24 -2 25 -65 25 l-65 0 0 -55 c0-52 1 -55 25 -55 22 0 25 -4 25 -35 0 -34 1 -35 40 -35 33 0 40 -3 40 -20 0-13 7 -20 20 -20 17 0 20 -7 20 -40 0 -36 3 -40 25 -40 25 0 25 -1 25 -85 0-84 0 -85 -25 -85 -20 0 -25 -5 -25 -25 0 -22 -4 -25 -40 -25 -38 0 -40 -2-40 -30 l0 -30 -65 0 -65 0 0 30 c0 23 -4 30 -20 30 -18 0 -20 7 -20 55 0 482 55 20 55 16 0 20 -7 20 -30 0 -23 4 -30 20 -30 15 0 20 -7 20 -25 0 -23 4-25 45 -25 41 0 45 2 45 25 0 18 5 25 20 25 16 0 20 7 20 30 0 23 -4 30 -2030 -16 0 -20 7 -20 35 0 28 -4 35 -20 35 -13 0 -20 7 -20 20 0 15 -7 20 -2520 -22 0 -25 4 -25 40 l0 40 -40 0 -40 0 0 110 c0 103 1 110 20 110 16 0 20 720 30 l0 30 105 0 105 0 0 -55z m470 0 c0 -52 -1 -55 -25 -55 -20 0 -25 5 -2525 0 24 -2 25 -65 25 -63 0 -65 -1 -65 -25 0 -20 -5 -25 -25 -25 -24 0 -25 -2-25 -65 0 -63 1 -65 25 -65 18 0 25 -5 25 -20 0 -13 7 -20 20 -20 13 0 20 720 20 0 17 7 20 45 20 l45 0 0 -60 0 -60 -90 0 -90 0 0 -85 c0 -84 0 -85 25-85 20 0 25 -5 25 -25 0 -22 4 -25 40 -25 36 0 40 3 40 25 0 20 5 25 25 25 210 25 5 25 30 0 29 2 30 45 30 43 0 45 -1 45 -30 0 -23 -4 -30 -20 -30 -15 0-20 -7 -20 -25 0 -20 -5 -25 -25 -25 -21 0 -25 -5 -25 -30 l0 -30 -65 0 -65 00 30 0 30 -70 0 -70 0 0 260 c0 253 -1 260 -20 260 -16 0 -20 7 -20 30 l0 30180 0 180 0 0 -55z m250 25 c0 -23 -4 -30 -20 -30 -15 0 -20 -7 -20 -25 0 -185 -25 20 -25 18 0 20 -7 20 -65 l0 -65 50 0 50 0 0 65 c0 63 1 65 25 65 20 025 5 25 25 0 20 -5 25 -25 25 -21 0 -25 5 -25 30 l0 30 90 0 90 0 0 -30 c0-29 -2 -30 -45 -30 l-45 0 0 -55 c0 -48 -2 -55 -20 -55 -16 0 -20 -7 -20 -350 -31 -3 -35 -25 -35 -24 0 -25 -3 -25 -60 0 -53 -2 -60 -20 -60 -18 0 -20 -7-20 -85 0 -78 2 -85 20 -85 15 0 20 -7 20 -25 0 -24 -2 -25 -70 -25 l-70 0 0150 c0 143 -1 150 -20 150 -18 0 -20 7 -20 55 0 48 -2 55 -20 55 -18 0 -20 7-20 55 l0 55 -45 0 c-43 0 -45 1 -45 30 l0 30 105 0 105 0 0 -30z m-5270 -230c0 -15 -7 -20 -25 -20 -18 0 -25 5 -25 20 0 15 7 20 25 20 18 0 25 -5 25 -20zm100 -60 l0 -80 -30 0 -30 0 0 80 0 80 30 0 30 0 0 -80z m300 0 l0 -40 -65 0-65 0 0 40 0 40 65 0 65 0 0 -40z m0 -235 c0 -20 -5 -25 -25 -25 -20 0 -25 5-25 25 0 20 5 25 25 25 20 0 25 -5 25 -25z m-400 -55 c0 -25 -4 -30 -25 -30-21 0 -25 5 -25 30 0 25 4 30 25 30 21 0 25 -5 25 -30z m350 -60 c0 -25 4 -3025 -30 20 0 25 -5 25 -25 0 -23 -4 -25 -45 -25 -41 0 -45 -2 -45 -25 0 -18 -5-25 -20 -25 -15 0 -20 7 -20 25 0 18 5 25 20 25 15 0 20 7 20 25 0 18 -5 25-20 25 -16 0 -20 7 -20 30 0 28 2 30 40 30 38 0 40 -2 40 -30z m230 -55 c0-20 -5 -25 -25 -25 -20 0 -25 5 -25 25 0 20 5 25 25 25 20 0 25 -5 25 -25zm-440 -50 c0 -18 -5 -25 -20 -25 -15 0 -20 7 -20 25 0 18 5 25 20 25 15 0 20-7 20 -25z m80 -70 c0 -38 -3 -45 -20 -45 -17 0 -20 7 -20 45 0 38 3 45 20 4517 0 20 -7 20 -45z")
    
    }
}
  
function DarkModeToggle() {

    $(document).on('click', '.dark-mode-switcher', function (e) {
        mode = getDarkMode();
    
        if (mode == "dark") {
            document.getElementsByTagName('meta')["color-scheme"].content = "light";
            
            // document.querySelector('meta[name="color-scheme"]').setAttribute("content", "light");
            mode = "light"

            setDarkMode(mode)

            localStorage.setItem("darkMode", mode);

        } else if (mode == "light") {
            document.getElementsByTagName('meta')["color-scheme"].content = "dark";
            
            // document.querySelector('meta[name="color-scheme"]').setAttribute("content", "dark");
            mode = "dark"

            setDarkMode(mode)
            localStorage.setItem("darkMode", mode);
        }
    });
}