{% extends 'ubyssey/base.html' %}
{% load humanize %}
{% load static %}
{% load wagtailcore_tags %}
{% load wagtailimages_tags %}
{% load wagtailuserbar %}
{% load ubyssey_ad_tags %}

{% block head_scripts %}
  <!-- Register ads for section page -->
  {% for orderable in settings.ads.AdTagSettings.section_head_tags.all %}
    {% gpt_define_tag orderable.ad_slot %}
  {% endfor %}
{% endblock %}

{% block header %}
  {% include 'navigation/headers/topbar.html' %}
  {% include 'navigation/headers/mobile.html' %}
{% endblock %}

{% block content %}
<div id="category_modal" class="modal">
  <div class="category_menu u-container u-container--padded">
  <i class="fa fa-ban c-section__modal_close" onclick="document.getElementById('category_modal').style.display = 'none'"></i>
  <h1><i class="fa fa-tag"></i> Series</h1>
  <p><a href="{% pageurl self %}">{{self.title}}</a> - {{self.description}}</p>
  {% if self.category_menu.count %}
      <ul>
        {% for category_menu_item in self.category_menu.all %}
          {% if category_menu_item.category %}
            <li><a href="{% pageurl self %}category/{{ category_menu_item.category.slug }}">{{ category_menu_item.category.title }}</a> â€” {{ category_menu_item.category.description }}</li>
          {% else %}
            {% comment %} Failsafe, since wagtail seems to delete empty menu items. Shouldn't ever end up here! {% endcomment %}
            <li><a href="#">ERROR: EMPTY CATEGORY MENU ITEM! PLEASE CHECK THE SECTION PAGE IN WAGTAIL</a></li>
          {% endif %}
        {% endfor %}
      </ul>
  {% endif %}
  </div>
</div>

  <main class="section">
    <!-- Place header ads for section page -->
    {% for orderable in settings.ads.AdTagSettings.section_header_placements.all %}
      {% gpt_placement_tag orderable.ad_slot %}
    {% endfor %}
    
    <div class="u-container u-container--large">

      {% if banner %}
        {% image banner width-700 as banner_image %}
        <div class="banner" style="background-image: url('{{banner_image.full_url}}');">
          <h1 class="c-page__heading">{{title}}</h1>
        </div>
      {%else%}
        <h1 class="c-page__heading">{{title}}</h1>
      {% endif %}

      <div class="c-section__info">    
        <p class="c-section__description">{{description}} &ensp;{% if not category %}<a href="/{{self.slug}}" aria-label="Go to section's rss feed"><i class="fa fa-rss"></i></a>{% endif%}</p>
        <div class="c-section__buttons">
          <div class="o-archive__search c-section__button-label">
            <form method="get">
              <label class="o-archive__search__label" for="c-articles-list__searchbar"><i
                  class="fa fa-search"></i></label>
              <input class="o-archive__search__input" name="q" id="c-articles-list__searchbar" type="text"
                {% if search_query %}value="{{ search_query }}" {% endif %} placeholder="Search" />
            </form>
          </div>
      
          <p class="c-section__button-label" onclick="document.getElementById('category_modal').style.display = 'block'"><i class="fa fa-tag"></i> Series</p>
        </div>
      </div>

      <div class="lightmode c-infinitefeed__feed">
        <div class="u-container">
          {% include 'infinitefeed/infinitefeed.html' with filters=filters %}
        </div>


        {% include 'infinitefeed/objects/infinitefeed-sidebar.html' with styling="c-section__sidebar" id="sidebar" sidebar_stream=self.sidebar_stream %}

      </div>
    </div>
  </main>
{% endblock %}
